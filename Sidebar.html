<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* =================================================
       ã‚«ã‚¹ã‚¿ãƒ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ï¼ˆCSSå¤‰æ•°ï¼‰
       ================================================= */
    :root {
      --twitter-blue: #1DA1F2;
      --twitter-blue-dark: #1a91da;
      --discord-blurple: #5865F2;
      --notion-black: #000000;
      --bg-color: #f7f9fa;
      --card-bg: #ffffff;
      --text-primary: #14171a;
      --text-secondary: #657786;
      --border-color: #e1e8ed;
      --success: #17bf63;
      --error: #e0245e;
      --warning: #ffad1f;
      --input-bg: #ffffff;
      --input-border: #ccd6dd;
      --input-focus: #1DA1F2;
      --shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    /* =================================================
       åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ«
       ================================================= */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-color);
      color: var(--text-primary);
      font-size: 14px;
      line-height: 1.5;
      padding: 0;
      margin: 0;
    }

    /* =================================================
       ã‚³ãƒ³ãƒ†ãƒŠ
       ================================================= */
    .container {
      padding: 16px;
    }

    /* =================================================
       ãƒ˜ãƒƒãƒ€ãƒ¼
       ================================================= */
    .header {
      background: linear-gradient(135deg, var(--twitter-blue), var(--discord-blurple));
      color: white;
      padding: 20px 16px;
      margin: -16px -16px 16px -16px;
      text-align: center;
    }

    .header h1 {
      font-size: 18px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .header p {
      font-size: 12px;
      opacity: 0.9;
    }

    /* =================================================
       ã‚»ã‚¯ã‚·ãƒ§ãƒ³
       ================================================= */
    .section {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: var(--shadow);
    }

    .section-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-secondary);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .section-title .icon {
      font-size: 16px;
    }

    /* =================================================
       ãƒ•ã‚©ãƒ¼ãƒ è¦ç´ 
       ================================================= */
    .form-group {
      margin-bottom: 14px;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 6px;
    }

    .input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
    }

    input[type="text"],
    input[type="password"] {
      width: 100%;
      padding: 10px 40px 10px 12px;
      border: 2px solid var(--input-border);
      border-radius: 8px;
      font-size: 13px;
      background: var(--input-bg);
      color: var(--text-primary);
      transition: all 0.2s ease;
    }

    input[type="text"]:focus,
    input[type="password"]:focus {
      outline: none;
      border-color: var(--input-focus);
      box-shadow: 0 0 0 3px rgba(29, 161, 242, 0.2);
    }

    input[type="text"]::placeholder,
    input[type="password"]::placeholder {
      color: var(--text-secondary);
    }

    /* =================================================
       ç›®ç‰ã‚¢ã‚¤ã‚³ãƒ³ãƒœã‚¿ãƒ³ï¼ˆè¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆï¼‰
       ================================================= */
    .toggle-visibility-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-secondary);
      transition: all 0.2s ease;
    }

    .toggle-visibility-btn:hover {
      background: rgba(0,0,0,0.05);
      color: var(--text-primary);
    }

    .toggle-visibility-btn svg {
      width: 20px;
      height: 20px;
    }

    .toggle-visibility-btn .eye-open {
      display: block;
    }

    .toggle-visibility-btn .eye-closed {
      display: none;
    }

    .toggle-visibility-btn.visible .eye-open {
      display: none;
    }

    .toggle-visibility-btn.visible .eye-closed {
      display: block;
    }

    /* =================================================
       ãƒœã‚¿ãƒ³
       ================================================= */
    .btn {
      width: 100%;
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--twitter-blue), var(--twitter-blue-dark));
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(29, 161, 242, 0.4);
    }

    .btn-primary:active {
      transform: translateY(0);
    }

    .btn-secondary {
      background: var(--bg-color);
      color: var(--text-secondary);
      margin-top: 8px;
    }

    .btn-secondary:hover {
      background: var(--border-color);
      color: var(--text-primary);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    /* =================================================
       ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
       ================================================= */
    .status {
      padding: 10px 12px;
      border-radius: 8px;
      font-size: 13px;
      margin-top: 12px;
      display: none;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .status.success {
      background: rgba(23, 191, 99, 0.1);
      color: var(--success);
      border: 1px solid rgba(23, 191, 99, 0.3);
      display: block;
    }

    .status.error {
      background: rgba(224, 36, 94, 0.1);
      color: var(--error);
      border: 1px solid rgba(224, 36, 94, 0.3);
      display: block;
    }

    /* =================================================
       ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°
       ================================================= */
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top-color: white;
      animation: spin 0.8s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* =================================================
       ã‚¤ãƒ³ãƒ•ã‚©ãƒœãƒƒã‚¯ã‚¹
       ================================================= */
    .info-box {
      background: rgba(29, 161, 242, 0.1);
      border: 1px solid rgba(29, 161, 242, 0.3);
      border-radius: 8px;
      padding: 12px;
      font-size: 12px;
      color: var(--twitter-blue);
      margin-top: 16px;
    }

    .info-box a {
      color: var(--twitter-blue);
      text-decoration: underline;
    }

    /* =================================================
       ãƒ‡ã‚£ãƒã‚¤ãƒ€ãƒ¼
       ================================================= */
    .divider {
      height: 1px;
      background: var(--border-color);
      margin: 16px 0;
    }

    /* =================================================
       ãƒ•ãƒƒã‚¿ãƒ¼
       ================================================= */
    .footer {
      text-align: center;
      padding: 16px;
      font-size: 11px;
      color: var(--text-secondary);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="header">
      <h1>ğŸ¦ Twitter RSS è¨­å®š</h1>
      <p>API ã‚­ãƒ¼ã¨é€šçŸ¥è¨­å®šã‚’ç®¡ç†</p>
    </div>

    <!-- COMPOSIOè¨­å®š -->
    <div class="section">
      <div class="section-title">
        <span class="icon">ğŸ”‘</span>
        COMPOSIOè¨­å®šï¼ˆå¿…é ˆï¼‰
      </div>

      <div class="form-group">
        <label for="composioApiKey">Composio API Key</label>
        <div class="input-wrapper">
          <input type="password" id="composioApiKey" placeholder="â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—">
          <button type="button" class="toggle-visibility-btn" onclick="toggleVisibility('composioApiKey', this)">
            <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
              <line x1="1" y1="1" x2="23" y2="23"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="form-group">
        <label for="connectedAccountId">Connected Account ID</label>
        <div class="input-wrapper">
          <input type="password" id="connectedAccountId" placeholder="ca_â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—">
          <button type="button" class="toggle-visibility-btn" onclick="toggleVisibility('connectedAccountId', this)">
            <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
              <line x1="1" y1="1" x2="23" y2="23"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="form-group">
        <label for="entityId">Entity IDï¼ˆUser IDï¼‰</label>
        <div class="input-wrapper">
          <input type="password" id="entityId" placeholder="pg-â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—">
          <button type="button" class="toggle-visibility-btn" onclick="toggleVisibility('entityId', this)">
            <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
              <line x1="1" y1="1" x2="23" y2="23"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- DISCORDè¨­å®š -->
    <div class="section">
      <div class="section-title">
        <span class="icon">ğŸ’¬</span>
        DISCORDè¨­å®šï¼ˆä»»æ„ï¼‰
      </div>
      
      <div class="form-group">
        <label for="discordWebhookUrl">Discord Webhook URL</label>
        <div class="input-wrapper">
          <input type="password" id="discordWebhookUrl" placeholder="â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—">
          <button type="button" class="toggle-visibility-btn" onclick="toggleVisibility('discordWebhookUrl', this)">
            <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
              <line x1="1" y1="1" x2="23" y2="23"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- NOTIONè¨­å®š -->
    <div class="section">
      <div class="section-title">
        <span class="icon">ğŸ“</span>
        NOTIONè¨­å®šï¼ˆä»»æ„ï¼‰
      </div>

      <div class="form-group">
        <label for="notionApiKey">Notion API Key</label>
        <div class="input-wrapper">
          <input type="password" id="notionApiKey" placeholder="â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—">
          <button type="button" class="toggle-visibility-btn" onclick="toggleVisibility('notionApiKey', this)">
            <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
              <line x1="1" y1="1" x2="23" y2="23"/>
            </svg>
          </button>
        </div>
      </div>

      <div class="form-group">
        <label for="notionDatabaseId">Notion Database ID</label>
        <div class="input-wrapper">
          <input type="password" id="notionDatabaseId" placeholder="â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—â—">
          <button type="button" class="toggle-visibility-btn" onclick="toggleVisibility('notionDatabaseId', this)">
            <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
              <line x1="1" y1="1" x2="23" y2="23"/>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <!-- NOTIONãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆï¼ˆä»»æ„ï¼‰ -->
    <div class="section">
      <div class="section-title">
        <span class="icon">ğŸ—„ï¸</span>
        NOTIONãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆï¼ˆä»»æ„ï¼‰
      </div>

      <div class="form-group">
        <label for="notionParentPageId">Parent Page ID</label>
        <div class="input-wrapper">
          <input type="text" id="notionParentPageId" placeholder="ä½œæˆå…ˆãƒšãƒ¼ã‚¸ID">
        </div>
      </div>

      <div class="form-group">
        <label for="notionIntegrationKey">Integration Key (API Key)</label>
        <div class="input-wrapper">
          <input type="password" id="notionIntegrationKey" placeholder="ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚­ãƒ¼">
          <button type="button" class="toggle-visibility-btn" onclick="toggleVisibility('notionIntegrationKey', this)">
            <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
              <circle cx="12" cy="12" r="3"/>
            </svg>
            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
              <line x1="1" y1="1" x2="23" y2="23"/>
            </svg>
          </button>
        </div>
      </div>

      <button class="btn btn-primary" onclick="createNotionDatabase()">
        <span>ğŸ—„ï¸</span>
        ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆ
      </button>
    </div>

    <!-- æ¥ç¶šãƒ†ã‚¹ãƒˆ -->
    <div class="section">
      <div class="section-title">
        <span class="icon">ğŸ”Œ</span>
        æ¥ç¶šãƒ†ã‚¹ãƒˆ
      </div>

      <button class="btn btn-secondary" onclick="testComposio()">
        <span>ğŸ”‘</span>
        Composioæ¥ç¶šãƒ†ã‚¹ãƒˆ
      </button>

      <button class="btn btn-secondary" onclick="testDiscord()" style="margin-top: 8px;">
        <span>ğŸ’¬</span>
        Discordæ¥ç¶šãƒ†ã‚¹ãƒˆ
      </button>

      <button class="btn btn-secondary" onclick="testNotion()" style="margin-top: 8px;">
        <span>ğŸ“</span>
        Notionæ¥ç¶šãƒ†ã‚¹ãƒˆ
      </button>

      <div id="testStatus" class="status"></div>
    </div>

    <!-- ã‚¯ã‚¤ãƒƒã‚¯å®Ÿè¡Œ -->
    <div class="section">
      <div class="section-title">
        <span class="icon">âš¡</span>
        ã‚¯ã‚¤ãƒƒã‚¯å®Ÿè¡Œ
      </div>

      <button class="btn btn-primary" onclick="runSearch24h()" style="background: linear-gradient(135deg, #17bf63, #1DA1F2);">
        <span>ğŸ”</span>
        24æ™‚é–“ä»¥å†…ã‚’æ¤œç´¢
      </button>

      <button class="btn btn-secondary" onclick="checkTriggerStatus()" style="margin-top: 8px;">
        <span>â°</span>
        ãƒˆãƒªã‚¬ãƒ¼çŠ¶æ…‹ã‚’ç¢ºèª
      </button>
      
      <div id="quickStatus" class="status"></div>
    </div>

    <!-- ãƒœã‚¿ãƒ³ -->
    <button class="btn btn-primary" id="saveBtn" onclick="saveSettings()">
      <span>ğŸ’¾</span>
      ä¿å­˜ã™ã‚‹
    </button>

    <button class="btn btn-secondary" onclick="resetSettings()">
      <span>ğŸ”„</span>
      è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆ
    </button>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
    <div id="status" class="status"></div>

    <!-- ã‚¤ãƒ³ãƒ•ã‚©ãƒœãƒƒã‚¯ã‚¹ -->
    <div class="info-box">
      ğŸ’¡ <strong>ãƒ’ãƒ³ãƒˆ:</strong> API Keyã®å–å¾—æ–¹æ³•ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€Œâ“ ãƒ˜ãƒ«ãƒ—ã€ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
    </div>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <div class="footer">
      Twitter RSS Collector v1.0
    </div>
  </div>

  <script>
    // =================================================
    // åˆæœŸåŒ–
    // =================================================
    
    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«è¨­å®šã‚’å–å¾—
    document.addEventListener('DOMContentLoaded', function() {
      loadSettings();
    });

    // =================================================
    // è¨­å®šã®èª­ã¿è¾¼ã¿
    // =================================================
    
    function loadSettings() {
      google.script.run
        .withSuccessHandler(function(settings) {
          document.getElementById('composioApiKey').value = settings.composioApiKey || '';
          document.getElementById('connectedAccountId').value = settings.connectedAccountId || '';
          document.getElementById('entityId').value = settings.entityId || '';
          document.getElementById('discordWebhookUrl').value = settings.discordWebhookUrl || '';
          document.getElementById('notionApiKey').value = settings.notionApiKey || '';
          document.getElementById('notionDatabaseId').value = settings.notionDatabaseId || '';
          document.getElementById('notionParentPageId').value = settings.notionParentPageId || '';
          document.getElementById('notionIntegrationKey').value = settings.notionIntegrationKey || '';
        })
        .withFailureHandler(function(error) {
          showStatus('error', 'âŒ è¨­å®šã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        })
        .getSettings();
    }

    // =================================================
    // è¨­å®šã®ä¿å­˜
    // =================================================
    
    function saveSettings() {
      const saveBtn = document.getElementById('saveBtn');
      const originalContent = saveBtn.innerHTML;
      
      // ãƒœã‚¿ãƒ³ã‚’ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã«
      saveBtn.disabled = true;
      saveBtn.innerHTML = '<span class="loading"></span> ä¿å­˜ä¸­...';
      
      const settings = {
        composioApiKey: document.getElementById('composioApiKey').value,
        connectedAccountId: document.getElementById('connectedAccountId').value,
        entityId: document.getElementById('entityId').value,
        discordWebhookUrl: document.getElementById('discordWebhookUrl').value,
        notionApiKey: document.getElementById('notionApiKey').value,
        notionDatabaseId: document.getElementById('notionDatabaseId').value,
        notionParentPageId: document.getElementById('notionParentPageId').value,
        notionIntegrationKey: document.getElementById('notionIntegrationKey').value
      };
      
      google.script.run
        .withSuccessHandler(function(result) {
          saveBtn.disabled = false;
          saveBtn.innerHTML = originalContent;
          
          if (result.success) {
            showStatus('success', result.message);
          } else {
            showStatus('error', result.message);
          }
        })
        .withFailureHandler(function(error) {
          saveBtn.disabled = false;
          saveBtn.innerHTML = originalContent;
          showStatus('error', 'âŒ ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        })
        .saveSettings(settings);
    }

    // =================================================
    // è¨­å®šã®ãƒªã‚»ãƒƒãƒˆ
    // =================================================
    
    function resetSettings() {
      if (!confirm('æœ¬å½“ã«è¨­å®šã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nã™ã¹ã¦ã®API KeyãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) {
        return;
      }
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('composioApiKey').value = '';
            document.getElementById('connectedAccountId').value = '';
            document.getElementById('entityId').value = '';
            document.getElementById('discordWebhookUrl').value = '';
            document.getElementById('notionApiKey').value = '';
            document.getElementById('notionDatabaseId').value = '';
            document.getElementById('notionParentPageId').value = '';
            document.getElementById('notionIntegrationKey').value = '';
            
            showStatus('success', result.message);
          } else {
            showStatus('error', result.message);
          }
        })
        .withFailureHandler(function(error) {
          showStatus('error', 'âŒ ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        })
        .resetSettings();
    }

    // =================================================
    // è¡¨ç¤º/éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆï¼ˆç›®ç‰ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
    // =================================================
    
    function toggleVisibility(inputId, button) {
      const input = document.getElementById(inputId);
      
      if (input.type === 'password') {
        input.type = 'text';
        button.classList.add('visible');
      } else {
        input.type = 'password';
        button.classList.remove('visible');
      }
    }

    // =================================================
    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º
    // =================================================
    
    function showStatus(type, message) {
      const statusEl = document.getElementById('status');
      statusEl.className = 'status ' + type;
      statusEl.textContent = message;

      // 5ç§’å¾Œã«è‡ªå‹•ã§éè¡¨ç¤º
      setTimeout(function() {
        statusEl.className = 'status';
      }, 5000);
    }

    // =================================================
    // NOTIONãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
    // =================================================

    function createNotionDatabase() {
      const parentPageId = document.getElementById('notionParentPageId').value;
      const integrationKey = document.getElementById('notionIntegrationKey').value;

      if (!parentPageId || !integrationKey) {
        showStatus('error', 'âŒ Parent Page IDã¨Integration Keyã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }

      showStatus('success', 'ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆä¸­...');

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            // ä½œæˆæˆåŠŸï¼è‡ªå‹•ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«è¨­å®š
            document.getElementById('notionDatabaseId').value = result.databaseId;
            
            // Integration Keyã‚’Notion API Keyã«ã‚‚ã‚³ãƒ”ãƒ¼
            document.getElementById('notionApiKey').value = integrationKey;
            
            showStatus('success', 'ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆå®Œäº†ï¼è¨­å®šã‚’è‡ªå‹•ä¿å­˜ä¸­...');
            
            // è‡ªå‹•ã§ä¿å­˜ã‚’å®Ÿè¡Œ
            setTimeout(function() {
              saveSettingsAfterDbCreate();
            }, 500);
          } else {
            showStatus('error', 'âŒ ä½œæˆå¤±æ•—: ' + result.error);
          }
        })
        .withFailureHandler(function(error) {
          showStatus('error', 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .createNotionDatabaseFromSidebar(parentPageId, integrationKey);
    }
    
    // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆå¾Œã®è‡ªå‹•ä¿å­˜
    function saveSettingsAfterDbCreate() {
      const settings = {
        composioApiKey: document.getElementById('composioApiKey').value,
        connectedAccountId: document.getElementById('connectedAccountId').value,
        entityId: document.getElementById('entityId').value,
        discordWebhookUrl: document.getElementById('discordWebhookUrl').value,
        notionApiKey: document.getElementById('notionApiKey').value,
        notionDatabaseId: document.getElementById('notionDatabaseId').value,
        notionParentPageId: document.getElementById('notionParentPageId').value,
        notionIntegrationKey: document.getElementById('notionIntegrationKey').value
      };
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showStatus('success', 'âœ… ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆï¼†è¨­å®šä¿å­˜å®Œäº†ï¼\nNotionæ¥ç¶šãƒ†ã‚¹ãƒˆã§ç¢ºèªã§ãã¾ã™ã€‚');
          } else {
            showStatus('error', 'âŒ ä¿å­˜å¤±æ•—: ' + result.message);
          }
        })
        .withFailureHandler(function(error) {
          showStatus('error', 'âŒ ä¿å­˜ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .saveSettings(settings);
    }

    // =================================================
    // æ¥ç¶šãƒ†ã‚¹ãƒˆ
    // =================================================

    function showTestStatus(type, message) {
      const statusEl = document.getElementById('testStatus');
      statusEl.className = 'status ' + type;
      statusEl.textContent = message;

      setTimeout(function() {
        statusEl.className = 'status';
      }, 8000);
    }

    function testComposio() {
      showTestStatus('success', 'ğŸ”„ Composioæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆä¸­...');

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showTestStatus('success', 'âœ… Composio: ' + result.message);
          } else {
            showTestStatus('error', 'âŒ Composio: ' + result.message);
          }
        })
        .withFailureHandler(function(error) {
          showTestStatus('error', 'âŒ Composio ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .testComposioConnection();
    }

    function testDiscord() {
      showTestStatus('success', 'ğŸ”„ Discordæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆä¸­...');

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showTestStatus('success', 'âœ… Discord: ' + result.message);
          } else {
            showTestStatus('error', 'âŒ Discord: ' + result.message);
          }
        })
        .withFailureHandler(function(error) {
          showTestStatus('error', 'âŒ Discord ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .testDiscordConnection();
    }

    function testNotion() {
      showTestStatus('success', 'ğŸ”„ Notionæ¥ç¶šã‚’ãƒ†ã‚¹ãƒˆä¸­...');

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showTestStatus('success', 'âœ… Notion: ' + result.message);
          } else {
            showTestStatus('error', 'âŒ Notion: ' + result.message);
          }
        })
        .withFailureHandler(function(error) {
          showTestStatus('error', 'âŒ Notion ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .testNotionConnection();
    }

    // =================================================
    // ã‚¯ã‚¤ãƒƒã‚¯å®Ÿè¡Œ
    // =================================================

    function showQuickStatus(type, message) {
      const statusEl = document.getElementById('quickStatus');
      statusEl.className = 'status ' + type;
      statusEl.textContent = message;

      if (type === 'success' && !message.includes('ğŸ”„')) {
        setTimeout(function() {
          statusEl.className = 'status';
        }, 10000);
      }
    }

    function runSearch24h() {
      showQuickStatus('success', 'ğŸ”„ 24æ™‚é–“ä»¥å†…ã®ãƒ„ã‚¤ãƒ¼ãƒˆã‚’æ¤œç´¢ä¸­...');

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            showQuickStatus('success', 'âœ… ' + result.message);
          } else {
            showQuickStatus('error', 'âŒ ' + result.message);
          }
        })
        .withFailureHandler(function(error) {
          showQuickStatus('error', 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .runAllSearches24h();
    }

    function checkTriggerStatus() {
      showQuickStatus('success', 'ğŸ”„ ãƒˆãƒªã‚¬ãƒ¼çŠ¶æ…‹ã‚’ç¢ºèªä¸­...');

      google.script.run
        .withSuccessHandler(function(result) {
          if (result.active) {
            showQuickStatus('success', result.message);
          } else {
            showQuickStatus('error', result.message);
          }
        })
        .withFailureHandler(function(error) {
          showQuickStatus('error', 'âŒ ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .getTriggerStatus();
    }
  </script>
</body>
</html>

